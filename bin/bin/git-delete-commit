#!/usr/bin/env bash

source ${HOME}/bin/.lib/git.lib.sh


delete-commit() {
    __is_git_repo__ || return 1
    __check_no_args__ ${@} || return 1

    local first_commit="$(git rev-list --max-parents=0 HEAD)"

    for commit in ${@}; do
        git cat-file -e ${commit} &> /dev/null
        if [ $? -ne 0 ]; then
            echo "fatal: commit '${commit}' does not exist"
            continue
        fi

        if [[ "${first_commit}" == *"${commit}"* ]]; then
            echo "fatal: cannot delete first commit"
            continue
        fi

        git rebase --rebase-merges --onto ${commit}^ ${commit} &> /dev/null
    done

    echo "success: delete-commit"
    return 0
}

delete-commit ${@}

